/* Plugin generated by AMXX-Studio */

#include <amxmodx>
#include <amxmisc>
#include <fun>
#include <hamsandwich>
#include <cstrike>
#define PLUGIN "set gravity"
#define VERSION "1.0"
#define AUTHOR "frax"

new t_gravity;
new ct_gravity;

public plugin_init() {
	register_plugin(PLUGIN, VERSION, AUTHOR)
	t_gravity = create_cvar("amx_g_t", "1.0", FCVAR_NONE, "Sets starting gravity for Ts.", true, 0.0, false)
	ct_gravity = create_cvar("amx_g_ct", "1.0", FCVAR_NONE, "Sets starting gravity for CTs.", true, 0.0, false)
	register_concmd("amx_gravity", "cmd_gravity", ADMIN_SLAY, "amx_gravity <target> <hplamount>")
	RegisterHamPlayer(Ham_Spawn, "start_gravity", 1)
}

public cmd_gravity(id, level, cid){
	if(!cmd_access(id, level, cid, 3))
		return PLUGIN_HANDLED
		
	new targetArg[24]
	new gravityAmount[10]
	new players[32]
	new numOfPlayers = 0
	read_argv(1, targetArg, 24)
	read_argv(2, gravityAmount, 10)
	
	if(equali(targetArg, "@", 1))
	{
		if(equali(targetArg, "@T")){
			get_players_ex(players, numOfPlayers, GetPlayers_ExcludeDead | GetPlayers_MatchTeam, "TERRORIST")
		}
		else if(equali(targetArg, "@CT")){
			get_players_ex(players, numOfPlayers, GetPlayers_ExcludeDead | GetPlayers_MatchTeam, "CT")
		}
		else{
			return PLUGIN_HANDLED
		}
		for(new i = 0; i < numOfPlayers; i++){
			set_user_gravity(players[i], str_to_float(gravityAmount))
		}
		return PLUGIN_HANDLED
	}

	new playertarget = cmd_target(id, targetArg, 0)
	
	if(!playertarget){
		console_print(id, "%s could not be targeted", targetArg)
		return PLUGIN_HANDLED
	}
		
	set_user_gravity(playertarget, str_to_float(gravityAmount))
	return PLUGIN_HANDLED
}

public start_gravity(id){
	if(!is_user_alive(id))
		return PLUGIN_HANDLED

	switch(cs_get_user_team(id)){
		case 1:
		{
			set_user_gravity(id, get_pcvar_float(t_gravity))
			return PLUGIN_HANDLED
		}
		case 2:
		{
			set_user_gravity(id, get_pcvar_float(ct_gravity))
			return PLUGIN_HANDLED
		}
	}
	return PLUGIN_HANDLED
}

